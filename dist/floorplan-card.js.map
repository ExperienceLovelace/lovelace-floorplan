{"version":3,"file":"floorplan-card.js","sources":["../src/floorplan-card.js"],"sourcesContent":["global.$ = require(\"jquery\");\nvar YAML = require(\"yamljs\");\n\n// Package Information\nvar packageInfo = require(\"./../package.json\");\n\n// jQuery LongPress Plugin\nrequire(\"jquery.longpress\");\n\n// Main Floorplan lib\nrequire(\"floorplan\");\n\nimport { localize } from \"./localize/localize.ts\";\n\n// Display our Card Version in console\n/* eslint no-console: 0 */\nconsole.info(\n  `%c  LOVELACE-FLOORPLAN CARD \\n%c      ${localize(\"common.version\")}    ${\n    packageInfo.version\n  }    `,\n  \"color: orange; font-weight: bold; background: black\",\n  \"color: white; font-weight: bold; background: rgb(71, 170, 238)\"\n);\n\nclass FloorplanCard extends HTMLElement {\n  constructor() {\n    super();\n\n    this.version = \"1.1.8\";\n\n    this.isScriptsLoading = false;\n    this.isFloorplanLoading = false;\n\n    this.isFloorplanLoaded = false;\n\n    this.attachShadow({ mode: \"open\" });\n  }\n\n  setConfig(config) {\n    this.config = JSON.parse(JSON.stringify(config));\n\n    this.initCard(config);\n    this.setIsLoading(true);\n  }\n\n  set hass(hass) {\n    if (!this.config || this.isScriptsLoading || this.isFloorplanLoading)\n      return;\n\n    (this.isFloorplanLoaded\n      ? Promise.resolve()\n      : this.loadFloorplan(hass, this.config)\n    ).then(() => {\n      this.floorplan.hassChanged(hass);\n    });\n  }\n\n  loadFloorplan(hass, config) {\n    this.isFloorplanLoading = true;\n\n    const floorplan = new Floorplan();\n\n    const options = {\n      root: this.shadowRoot,\n      hass: hass,\n      openMoreInfo: this.openMoreInfo.bind(this),\n      setIsLoading: this.setIsLoading.bind(this),\n      config: (config && config.config) || config,\n    };\n\n    return floorplan.init(options).then(() => {\n      this.setIsLoading(false);\n      this.floorplan = floorplan;\n      this.isFloorplanLoading = false;\n      this.isFloorplanLoaded = true;\n    });\n  }\n\n  initCard(config) {\n    const root = this.shadowRoot;\n    if (root.lastChild) root.removeChild(root.lastChild);\n\n    const style = document.createElement(\"style\");\n    style.textContent = this.getStyle();\n    root.appendChild(style);\n\n    const card = document.createElement(\"ha-card\");\n    card.header = config.title;\n    root.appendChild(card);\n\n    const container = document.createElement(\"div\");\n    container.id = \"container\";\n    card.appendChild(container);\n\n    const spinner = document.createElement(\"paper-spinner-lite\");\n    container.appendChild(spinner);\n\n    const floorplan = document.createElement(\"div\");\n    floorplan.id = \"floorplan\";\n    container.appendChild(floorplan);\n\n    const log = document.createElement(\"div\");\n    log.id = \"log\";\n    container.appendChild(log);\n\n    const link = document.createElement(\"a\");\n    link.setAttribute(\"href\", \"#\");\n    link.text = \"Clear log\";\n    log.appendChild(link);\n    link.onclick = function () {\n      $(this).siblings(\"ul\").html(\"\").parent().css(\"display\", \"none\");\n    };\n\n    const list = document.createElement(\"ul\");\n    log.appendChild(list);\n\n    this.log = log;\n    this.spinner = spinner;\n  }\n\n  getStyle() {\n    return `\n      #container {\n        text-align: center;\n      }\n\n      paper-spinner-lite {\n        margin-bottom: 50px;\n      }\n\n      #log {\n        max-height: 150px;\n        overflow: auto;\n        background-color: #eee;\n        display: none;\n        padding: 10px;\n      }\n\n      #log ul {\n        list-style-type: none;\n        padding-left: 0px;\n        text-align: left;\n      }\n\n      .error {\n        color: #FF0000;\n      }\n\n      .warning {\n        color: #FF851B;\n      }\n\n      .info {\n        color: #0000FF;\n      }\n\n      .debug {\n        color: #000000;\n      }\n    `;\n  }\n\n  openMoreInfo(entityId) {\n    this.fire(\"hass-more-info\", { entityId: entityId });\n  }\n\n  setIsLoading(isLoading) {\n    this.isLoading = isLoading;\n\n    if (this.isLoading) {\n      this.spinner.setAttribute(\"active\", \"\");\n      this.spinner.style.display = \"inline-block\";\n    } else {\n      this.spinner.removeAttribute(\"active\");\n      this.spinner.style.display = \"none\";\n    }\n  }\n\n  logError(message) {\n    console.error(message);\n\n    $(this.log).find(\"ul\").prepend(`<li class=\"error\">${message}</li>`);\n    $(this.log).css(\"display\", \"block\");\n  }\n\n  fire(type, detail, options) {\n    options = options || {};\n    detail = detail === null || detail === undefined ? {} : detail;\n    const event = new Event(type, {\n      bubbles: options.bubbles === undefined ? true : options.bubbles,\n      cancelable: Boolean(options.cancelable),\n      composed: options.composed === undefined ? true : options.composed,\n    });\n    event.detail = detail;\n    const node = options.node || this;\n    node.dispatchEvent(event);\n    return event;\n  }\n\n  loadScript(scriptUrl, useCache) {\n    return new Promise((resolve, reject) => {\n      const script = document.createElement(\"script\");\n      script.async = true;\n      script.src = useCache ? scriptUrl : this.cacheBuster(scriptUrl);\n      script.onload = () => resolve();\n      script.onerror = (err) => reject(new URIError(`${err.target.src}`));\n      this.appendChild(script);\n    });\n  }\n\n  cacheBuster(url) {\n    return `${url}${\n      url.indexOf(\"?\") >= 0 ? \"&\" : \"?\"\n    }_=${new Date().getTime()}`;\n  }\n}\n\ncustomElements.define(\"floorplan-card\", FloorplanCard);\n"],"names":["global","$","require","packageInfo","console","info","localize","version","FloorplanCard","HTMLElement","[object Object]","super","this","isScriptsLoading","isFloorplanLoading","isFloorplanLoaded","attachShadow","mode","config","JSON","parse","stringify","initCard","setIsLoading","hass","Promise","resolve","loadFloorplan","then","floorplan","hassChanged","Floorplan","options","root","shadowRoot","openMoreInfo","bind","init","lastChild","removeChild","style","document","createElement","textContent","getStyle","appendChild","card","header","title","container","id","spinner","log","link","setAttribute","text","onclick","siblings","html","parent","css","list","entityId","fire","isLoading","display","removeAttribute","message","error","find","prepend","type","detail","event","Event","bubbles","undefined","cancelable","Boolean","composed","node","dispatchEvent","scriptUrl","useCache","reject","script","async","src","cacheBuster","onload","onerror","err","URIError","target","url","indexOf","Date","getTime","customElements","define"],"mappings":"4IAAAA,OAAOC,EAAIC,QAAQ,UACRA,QAAQ,UAAnB,IAGIC,EAAcD,QAAQ,qBAG1BA,QAAQ,oBAGRA,QAAQ,aAMRE,QAAQC,KACN,wVAAyCC,CAAS,wBAChDH,EAAYI,cAEd,sDACA,kEAGF,MAAMC,UAAsBC,YAC1BC,cACEC,QAEAC,KAAKL,QAAU,QAEfK,KAAKC,kBAAmB,EACxBD,KAAKE,oBAAqB,EAE1BF,KAAKG,mBAAoB,EAEzBH,KAAKI,aAAa,CAAEC,KAAM,SAG5BP,UAAUQ,GACRN,KAAKM,OAASC,KAAKC,MAAMD,KAAKE,UAAUH,IAExCN,KAAKU,SAASJ,GACdN,KAAKW,cAAa,GAGpBC,SAASA,IACFZ,KAAKM,QAAUN,KAAKC,kBAAoBD,KAAKE,qBAGjDF,KAAKG,kBACFU,QAAQC,UACRd,KAAKe,cAAcH,EAAMZ,KAAKM,SAChCU,MAAK,KACLhB,KAAKiB,UAAUC,YAAYN,MAI/Bd,cAAcc,EAAMN,GAClBN,KAAKE,oBAAqB,EAE1B,MAAMe,EAAY,IAAIE,UAEhBC,EAAU,CACdC,KAAMrB,KAAKsB,WACXV,KAAMA,EACNW,aAAcvB,KAAKuB,aAAaC,KAAKxB,MACrCW,aAAcX,KAAKW,aAAaa,KAAKxB,MACrCM,OAASA,GAAUA,EAAOA,QAAWA,GAGvC,OAAOW,EAAUQ,KAAKL,GAASJ,MAAK,KAClChB,KAAKW,cAAa,GAClBX,KAAKiB,UAAYA,EACjBjB,KAAKE,oBAAqB,EAC1BF,KAAKG,mBAAoB,KAI7BL,SAASQ,GACP,MAAMe,EAAOrB,KAAKsB,WACdD,EAAKK,WAAWL,EAAKM,YAAYN,EAAKK,WAE1C,MAAME,EAAQC,SAASC,cAAc,SACrCF,EAAMG,YAAc/B,KAAKgC,WACzBX,EAAKY,YAAYL,GAEjB,MAAMM,EAAOL,SAASC,cAAc,WACpCI,EAAKC,OAAS7B,EAAO8B,MACrBf,EAAKY,YAAYC,GAEjB,MAAMG,EAAYR,SAASC,cAAc,OACzCO,EAAUC,GAAK,YACfJ,EAAKD,YAAYI,GAEjB,MAAME,EAAUV,SAASC,cAAc,sBACvCO,EAAUJ,YAAYM,GAEtB,MAAMtB,EAAYY,SAASC,cAAc,OACzCb,EAAUqB,GAAK,YACfD,EAAUJ,YAAYhB,GAEtB,MAAMuB,EAAMX,SAASC,cAAc,OACnCU,EAAIF,GAAK,MACTD,EAAUJ,YAAYO,GAEtB,MAAMC,EAAOZ,SAASC,cAAc,KACpCW,EAAKC,aAAa,OAAQ,KAC1BD,EAAKE,KAAO,YACZH,EAAIP,YAAYQ,GAChBA,EAAKG,QAAU,WACbvD,EAAEW,MAAM6C,SAAS,MAAMC,KAAK,IAAIC,SAASC,IAAI,UAAW,SAG1D,MAAMC,EAAOpB,SAASC,cAAc,MACpCU,EAAIP,YAAYgB,GAEhBjD,KAAKwC,IAAMA,EACXxC,KAAKuC,QAAUA,EAGjBzC,WACE,MAAO,2mBAyCTA,aAAaoD,GACXlD,KAAKmD,KAAK,iBAAkB,CAAED,SAAUA,IAG1CpD,aAAasD,GACXpD,KAAKoD,UAAYA,EAEbpD,KAAKoD,WACPpD,KAAKuC,QAAQG,aAAa,SAAU,IACpC1C,KAAKuC,QAAQX,MAAMyB,QAAU,iBAE7BrD,KAAKuC,QAAQe,gBAAgB,UAC7BtD,KAAKuC,QAAQX,MAAMyB,QAAU,QAIjCvD,SAASyD,GACP/D,QAAQgE,MAAMD,GAEdlE,EAAEW,KAAKwC,KAAKiB,KAAK,MAAMC,QAAQ,qBAAqBH,UACpDlE,EAAEW,KAAKwC,KAAKQ,IAAI,UAAW,SAG7BlD,KAAK6D,EAAMC,EAAQxC,GACjBA,EAAUA,GAAW,GACrBwC,EAASA,MAAAA,EAA0C,GAAKA,EACxD,MAAMC,EAAQ,IAAIC,MAAMH,EAAM,CAC5BI,aAA6BC,IAApB5C,EAAQ2C,SAA+B3C,EAAQ2C,QACxDE,WAAYC,QAAQ9C,EAAQ6C,YAC5BE,cAA+BH,IAArB5C,EAAQ+C,UAAgC/C,EAAQ+C,WAE5DN,EAAMD,OAASA,EAGf,OAFaxC,EAAQgD,MAAQpE,MACxBqE,cAAcR,GACZA,EAGT/D,WAAWwE,EAAWC,GACpB,OAAO,IAAI1D,SAAQ,CAACC,EAAS0D,KAC3B,MAAMC,EAAS5C,SAASC,cAAc,UACtC2C,EAAOC,OAAQ,EACfD,EAAOE,IAAMJ,EAAWD,EAAYtE,KAAK4E,YAAYN,GACrDG,EAAOI,OAAS,IAAM/D,IACtB2D,EAAOK,QAAWC,GAAQP,EAAO,IAAIQ,SAAS,GAAGD,EAAIE,OAAON,QAC5D3E,KAAKiC,YAAYwC,MAIrB3E,YAAYoF,GACV,MAAO,GAAGA,IACRA,EAAIC,QAAQ,MAAQ,EAAI,IAAM,SAC3B,IAAIC,MAAOC,aAIpBC,eAAeC,OAAO,iBAAkB3F"}